知识点总结框架来自*codesheep*，有删改
### TCP/IP协议体系的认知
分层、透明性、对等

<div>
<img src="images/体系结构.png" width=540px></img>
</div>

### 物理层（优先度不高，暂略）

### 数据链路层
1. 数据链路层的三个基本问题：封装成帧、透明传输和差错检测  
   * 封装成帧（P72）  
    所有在互联网上传送的数据都以分组（即IP数据报）为传送单位。网络层的IP数据报传送到数据链路层就成为帧的数据部分。在帧的数据部分的前面和后面分别添加上首部和尾部，构成了一个完整的帧。这样的帧就是数据链路层的数据传送单元。  
    一个帧的帧长等于帧的数据部分的长度加上帧首部和帧尾部的长度。首部和尾部的一个重要作用就是进行**帧定界**（即确定帧的界限）。此外，首部和尾部还包括许多必要的控制信息。在发送帧时，是从帧的首部开始发送的。各种数据链路层协议都对帧首部和帧尾部的格式有明确的规定。显然，为了提高帧的传输效率，应当使帧的数据部分长度尽可能大地大于首部和尾部长度。但是，每一种链路层协议都规定了所能传送的帧的**数据部分长度上限————最大传送单元MTU(Maximum Transfer Unit)**。  
    （图待补充）  
    当传送可打印ASCII字符时，可使用SOH和EOH进行帧定界。  
    * 透明传输  
    使用字节填充/字符填充（在数据部分的SOH或EOH前加上转义字符ESC）保证透明传输  
    * 差错检测  
    使用循环冗余检验CRC（Cyclic Redundancy Check）进行差错检测  

2. 以太网MAC帧的格式(P96)
   
    <div>
    <img src="images/mac帧.png" width=540px></img>
    </div>

    前同步码： 调整时钟频率，进行位同步   
    帧开始定界符： 说明帧从下一个字节开始      
    目的地址：mac地址，送到哪里去  
    源地址：mac地址，从哪里来  
    类型：说明上一层使用的是什么协议  
    FCS：帧检验序列  

3. ARP协议（P124）  
    地址解析协议ARP：通过IP地址找到其物理地址  
    逆地址解析协议RARP（已经被DHCP协议取代）  
    每一台计算机都设有一个**ARP高速缓存（ARP Cache）**，里面有**本局域网上**的个主机和各路由器的IP地址到硬件地址的映射表。找不到就广播。  



### 网络层  
1. IP数据报的格式(P128)  
    <div>
    <img src="images/IP首部.png" width=540px></img>
    </div>

    一个IP数据报由首部和数据两部分组成，首部的前一部分是**固定长度**，共20字节，是所有IP数据报必须具有的。在首部的固定部分的后面是一些**可选字段**，其长度是可变的。

    * IP数据报首部的固定部分中的各字段
    1. 版本  
    占4位，指IP协议的版本。目前广泛使用的IP协议版本号为4（即IPv4）
    2. 首部长度  
    占4位，可表示的最大十进制数值为15（这里的15是15个32位字，即60字节，因此首部长度最小为5，最大为15）。  
    3. 区分服务  
    占8位，用来获得更好的服务。  
    4. 总长度  
    总长度字段为8字节，因此数据报的最大长度为2^16-1=65535字节  
    在IP层下面的每一种数据链路层协议都规定了一个数据帧中的数据字段的**最大长度**，这称为最大传送单元MTU（Maximum Transfer Unit）。当一个IP数据报封装成链路层的帧时，此数据包的总长度（即首部加上数据部分）一定不能超过下面的数据链路层所规定的MTU值。例如，最常用的以太网就规定其MTU值是1500字节。若所传送的数据报长度超过数据链路层的MTU值，就必须把过长的数据报进行分片处理。  
    在进行分片时（见后面的“片偏移”字段），数据报首部中的“总长度”字段是指分片后的每一个分片的首部长度与该分片的数据长度的总和。  
    5.标识  
    占16位。IP软件在存储器中维持一个计算器，每产生一个数据报，计数器就加1，并将此值赋给标识字段。**但这个“标识”并不是序号**，因为IP是面向无连接的服务，数据报不存在按序接收的问题。当数据报由于超过网络的MTU而必须分片时，这个标识字段的值都被复制到所有的数据报片的标识字段中。相同的标识字段的值使分片后的各数据报片最后能正确地重装成为原来的数据报。  
    6. 标志  
    占3位，但目前只有两位有意义。  
    * 标志字段的最低位记为**MF(More Fragment)**。MF=1即表示后面“还有分片”的数据报。MF=0表示这已经是若干数据报片中的最后一个。
    * 标志字段的中间一位记为**DF(Don't Fragment)**，意思是“不能分片”。只有当DF=0时才允许分片。
    7. 片偏移  
    占13位，片偏移指出：较长的分组在分片后，某片在原分组中的相对位置。也就是说，相对于用户数据字段的起点，该片从何处开始。片偏移以8个字节为偏移单位。这就是说，除最后一个数据报片外，每个分片的长度一定是8字节的整数倍。
    8. 生存时间  
    占8位，生存时间字段常用的英文缩写是TTL(Time To Live)，表明这是数据报在网络中的**寿命**。由发出数据包的源点设置这个字段。其目的是防止无法交付的数据报无限制地在网络中兜圈子。  
    现在TTL的单位不再是秒，而是跳数。
    9. 协议  
    占8位，协议字段指出此数据报携带的数据是使用何种协议，以便使目的主机的IP层直到应将数据部分上交给哪个协议进行处理。  
    10.  首部检验和  
    占16位。这个字段只检验数据报的首部，但不包括数据部分。  
    这是为了减少计算的工作量，不计算数据部分。为了进一步减小工作量，IP首部的检验不适用复杂的CRC检验码而采用下面的简单计算方法：  
    将检验和字段置零，用反码算术运算把所有16位字相加后，再取反码放入检验和字段。
    11. 源地址
    占32位。
    12. 目的地址  
    占32位。

2. 分组转发算法：
    1. 从数据包的首部提取目的主机的IP地址D，得出目的网络地址N。  
    2. 若N就是与此路由器直接相连的某个网络地址，则进行直接交付，不需要再经过其他的路由器，直接把数据报交付目的主机（这里包括把目的主机地址D转换为具体的硬件地址，把数据报封装为MAC帧，再发送此帧）；否则就是间接交付，执行（3）。  
    3. 若路由表中有目的地址位D的特定主机路由，则把数据报传送给路由表中的所知名的下一跳路由器；否则，执行（4）。  
    4. 若路由表中有到达网络N的路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行（5）；  
    5. 若路由表中有一个默认路由，则把数据报传送给路由表中所知名的默认路由器；否则，执行（6）；  
    6. 报告分组转发出错

3. 网际控制报文协议ICMP(待更新)  
    为了更有效地转发IP数据报和提高交付成功的机会，在网际层使用了网际控制报文ICMP。  
    1. ICMP报文的种类 
    ICMP报文有两种，即ICMP差错报告报文和ICMP询问报文。

### 传输层
   